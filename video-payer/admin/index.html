<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de V√≠deo</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6">
  <div class="w-full max-w-3xl bg-white shadow-lg rounded-2xl p-6">
    <h1 class="text-2xl font-bold mb-6">üìä Analisar V√≠deo</h1>

    <!-- Input para inserir o videoId -->
    <div class="flex space-x-2 mb-6">
      <input id="videoIdInput" type="text" placeholder="Digite o ID do v√≠deo"
        class="w-full px-4 py-2 border rounded-lg focus:ring focus:ring-blue-300 outline-none">
      <button id="loadBtn"
        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Carregar</button>
    </div>

    <!-- √Årea onde aparece o card -->
    <div id="videoInfo"></div>
  </div>

  <!-- Firebase -->
  <script type="module" defer>
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore, collection, getDocs
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Configura√ß√£o Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDfNNPtqhpG7ShUJo8n89ONoKOq45Xy91w",
      authDomain: "drop-payments-mz.firebaseapp.com",
      databaseURL: "https://drop-payments-mz-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "drop-payments-mz",
      storageBucket: "drop-payments-mz.appspot.com",
      messagingSenderId: "983262508468",
      appId: "1:983262508468:web:c0a6e26cf8789807b26ee1",
      measurementId: "G-JBP3RN50WS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const videoInfoEl = document.getElementById("videoInfo");
    const loadBtn = document.getElementById("loadBtn");
    const videoIdInput = document.getElementById("videoIdInput");

    // üîπ Fun√ß√£o para contar visualiza√ß√µes √∫nicas
    async function countViews(videoId) {
      const viewsRef = collection(db, "videos", videoId, "views");
      const snap = await getDocs(viewsRef);
      return snap.size;
    }

    // üîπ Fun√ß√£o para contar cliques dentro de cada view
    async function countClicks(videoId) {
      const viewsRef = collection(db, "videos", videoId, "views");
      const viewsSnap = await getDocs(viewsRef);

      let totalClicks = 0;
      for (const viewDoc of viewsSnap.docs) {
        const clicksRef = collection(db, "videos", videoId, "views", viewDoc.id, "clicks");
        const clicksSnap = await getDocs(clicksRef);
        totalClicks += clicksSnap.size;
      }
      return totalClicks;
    }

    // üîπ Fun√ß√£o principal para buscar e renderizar
    async function loadVideoById(videoId) {
      try {
        videoInfoEl.innerHTML = `<p class="text-gray-500">üîé Buscando informa√ß√µes...</p>`;

        const views = await countViews(videoId);
        const clicks = await countClicks(videoId);

        videoInfoEl.innerHTML = `
          <div class="bg-gray-50 border rounded-xl p-4 shadow hover:shadow-lg transition">
            <h2 class="font-semibold text-lg mb-2">üé¨ V√≠deo: ${videoId}</h2>
            <p class="text-sm text-gray-600 mb-1">ID: ${videoId}</p>
            <div class="flex justify-between mt-2">
              <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-sm">üëÅÔ∏è ${views} views</span>
              <span class="bg-green-100 text-green-700 px-3 py-1 rounded-lg text-sm">üñ±Ô∏è ${clicks} clicks</span>
            </div>
          </div>
        `;
      } catch (error) {
        console.error("Erro ao carregar v√≠deo:", error);
        videoInfoEl.innerHTML = `<p class="text-red-500">‚ö†Ô∏è Erro ao carregar dados do v√≠deo.</p>`;
      }
    }

    // Evento do bot√£o
    loadBtn.addEventListener("click", () => {
      const videoId = videoIdInput.value.trim();
      if (!videoId) {
        alert("Digite um ID de v√≠deo v√°lido!");
        return;
      }
      loadVideoById(videoId);
    });
  </script>
</body>
</html>
